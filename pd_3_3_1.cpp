#include <iostream>
#include <vector>
#include <complex>
#include <iomanip>
using namespace std;

#include "Eigen/Dense"
using Eigen::VectorXcf;
using Eigen::MatrixXcf;


MatrixXcf get_mk_mul(const int n, const int k, const MatrixXcf& adjacency_matrix)
{
	if (k == 1)
		return adjacency_matrix;

	MatrixXcf ret(n, n);
	ret = adjacency_matrix;

	for (int i = 1; i < k; i++)
		ret = ret * adjacency_matrix;

	return ret;
}


int main(void)
{
	std::cout << std::fixed;
	std::cout << std::setprecision(5);

	const int n = 8;
	const int k = 6;

	MatrixXcf adjacency_matrix(n, n); // aka M^1

	const complex<float> u = 1.0f;
	const complex<float> a = u / sqrtf(2.0f);
	const complex<float> b = complex<float>(-1.0f,  1.0f) / sqrtf(6.0f);
	const complex<float> c = complex<float>(-1.0f, -1.0f) / sqrtf(6.0f);
	const complex<float> d = complex<float>( 1.0f, -1.0f) / sqrtf(6.0f);

	adjacency_matrix <<
		0, 0, 0, 0, 0, 0, 0, 0,
		a, 0, 0, 0, 0, 0, 0, 0,
		a, 0, 0, 0, 0, 0, 0, 0,
		0, b, 0, u, 0, 0, 0, 0,
		0, c, 0, 0, u, 0, 0, 0,
		0, d, b, 0, 0, u, 0, 0,
		0, 0, c, 0, 0, 0, u, 0,
		0, 0, d, 0, 0, 0, 0, u;

	cout << adjacency_matrix << endl << endl;

	VectorXcf state_vector(n); // aka X
	state_vector <<
		complex<float>(1, 8), 
		complex<float>(2, 7),
		complex<float>(3, 6),
		complex<float>(4, 5),
		complex<float>(5, 4),
		complex<float>(6, 3),
		complex<float>(7, 2),
		complex<float>(8, 1);

	cout << "Start: " << state_vector.transpose() << endl << endl;

	for (int i = 1; i <= k; i++)
	{
		state_vector = adjacency_matrix * state_vector; // aka Y = MX
		cout << "Pos " << i << " " << state_vector.transpose() << endl << endl;
	}


	// Get M^k path probability, where k = 1 through 6
	cout << endl;

	// Note that M^3 and higher are equal to M^2
	for (int i = 1; i <= k; i++)
		cout << "M^" << i << " = " << endl << get_mk_mul(n, i, adjacency_matrix) << endl << endl;

	return 0;
}


/*
Output:

  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.70711,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.70711,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

Start: (1.00000,8.00000) (2.00000,7.00000) (3.00000,6.00000) (4.00000,5.00000) (5.00000,4.00000) (6.00000,3.00000) (7.00000,2.00000) (8.00000,1.00000)

Pos 1  (0.00000,0.00000)  (0.70711,5.65685)  (0.70711,5.65685)  (0.32577,2.95876)  (7.04124,0.32577)  (6.00000,3.81650) (8.22474,-1.67423) (11.67423,2.22474)

Pos 2   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)  (-2.27231,0.93803)  (9.06197,-2.27231)   (6.00000,3.81650) (10.24547,-4.27231)  (14.27231,4.24547)

Pos 3   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)  (-2.27231,0.93803)  (9.06197,-2.27231)   (6.00000,3.81650) (10.24547,-4.27231)  (14.27231,4.24547)

Pos 4   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)  (-2.27231,0.93803)  (9.06197,-2.27231)   (6.00000,3.81650) (10.24547,-4.27231)  (14.27231,4.24547)

Pos 5   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)  (-2.27231,0.93803)  (9.06197,-2.27231)   (6.00000,3.81650) (10.24547,-4.27231)  (14.27231,4.24547)

Pos 6   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)  (-2.27231,0.93803)  (9.06197,-2.27231)   (6.00000,3.81650) (10.24547,-4.27231)  (14.27231,4.24547)


M^1 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.70711,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.70711,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

M^2 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
 (-0.28868,0.28868)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
 (0.28868,-0.28868)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

M^3 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
 (-0.28868,0.28868)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
 (0.28868,-0.28868)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

M^4 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
 (-0.28868,0.28868)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
 (0.28868,-0.28868)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

M^5 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
 (-0.28868,0.28868)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
 (0.28868,-0.28868)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)

M^6 =
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
 (-0.28868,0.28868)  (-0.40825,0.40825)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
  (0.00000,0.00000)  (0.40825,-0.40825)  (-0.40825,0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)
(-0.28868,-0.28868)   (0.00000,0.00000) (-0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)   (0.00000,0.00000)
 (0.28868,-0.28868)   (0.00000,0.00000)  (0.40825,-0.40825)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (0.00000,0.00000)   (1.00000,0.00000)


*/